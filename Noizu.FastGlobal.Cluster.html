<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.3">
    <meta name="project" content="noizu_core v1.0.26">

    <title>Noizu.FastGlobal.Cluster ‚Äî noizu_core v1.0.26</title>
    <link rel="stylesheet" href="dist/elixir-d5ff82e6b0f5651c0ac0.css" />

    <script src="dist/sidebar_items-78d6d0312d.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-a088a6cc33ae3464193e.js"></script>


  </head>
  <body data-type="modules">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

    <div class="sidebar-projectDetails">
      <a href="api-reference.html" class="sidebar-projectName" translate="no">
noizu_core
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v1.0.26
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L6" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span translate="no">Noizu.FastGlobal.Cluster</span> 
  <small class="app-vsn" translate="no">(noizu_core v1.0.26)</small>

</h1>


  <section id="moduledoc">
<p>The <a href="Noizu.FastGlobal.Cluster.html#content"><code class="inline">Noizu.FastGlobal.Cluster</code></a> module provides functionality for handling global data in a distributed cluster.</p><h1>Functionality</h1><ul><li><a href="#get_settings/0"><code class="inline">get_settings/0</code></a>: Retrieves the settings for the FastGlobal cluster.</li><li><a href="#sync_record__write/4"><code class="inline">sync_record__write/4</code></a>: Writes a record to the FastGlobal cluster.</li><li><a href="#sync_record/4"><code class="inline">sync_record/4</code></a>: Retrieves a record from the FastGlobal cluster.</li><li><a href="#get/1"><code class="inline">get/1</code></a>: Retrieves the value for a given identifier from the FastGlobal cluster.</li><li><a href="#get/2"><code class="inline">get/2</code></a>: Retrieves the value for a given identifier from the FastGlobal cluster with a default value.</li><li><a href="#get/3"><code class="inline">get/3</code></a>: Retrieves the value for a given identifier from the FastGlobal cluster with a default value and options.</li><li><a href="#get_record/1"><code class="inline">get_record/1</code></a>: Retrieves a record for a given identifier from the FastGlobal cluster.</li><li><a href="#put/3"><code class="inline">put/3</code></a>: Puts a value into the FastGlobal cluster.</li><li><code class="inline">put/4</code>: Puts a value into the FastGlobal cluster with options.</li><li><a href="#coordinate_put/4"><code class="inline">coordinate_put/4</code></a>: Coordinates the put operation in the FastGlobal cluster.</li></ul><h1>Code Review</h1><ul><li><p>üìö Readability: The code is well-documented and includes clear explanations of each function's purpose and steps. The comments and documentation help understand the code's behavior and usage. üëç</p></li><li><p>üßæ Best practices: The code follows Elixir best practices, such as using pattern matching, proper error handling, and appropriate function naming. It adheres to the conventions and guidelines of the Elixir language. üëç</p></li><li><p>‚öô Code Efficiency: The code demonstrates efficient approaches, such as acquiring semaphore locks for exclusive access, parallel processing of updates on different nodes, and handling synchronization in a distributed cluster. The implementation appears to be optimized for performance. üëç</p></li><li><p>üë∑‚Äç‚ôÄÔ∏è Maintainability:</p><ul><li>The code is relatively easy to maintain due to its clear structure, proper documentation, and adherence to best practices.
However, there are some areas of complexity, such as nested <code class="inline">cond</code> clauses, which could benefit from refactoring to
improve readability and maintainability. Consider breaking down complex sections into separate functions or
improving pattern matching. üëå</li><li>Code Complexity: The code exhibits moderate complexity, mainly due to nested conditionals and a few long functions.
Refactoring some of the more complex sections can further improve code maintainability and readability.</li></ul></li><li><p>üëÆ Safety/Security: The code includes appropriate error handling and logging, which helps identify potential issues and ensures error-free execution. It demonstrates good practices for handling distributed operations and maintaining data consistency. The code appears to be safe and secure. üëç</p></li><li><p>üé™ Other: The code provides good modularity and separation of concerns by using separate functions for different operations. It follows a clear and logical structure, making it easy to understand and navigate. The use of protocols and well-defined interfaces adds flexibility and extensibility to the codebase. üëç</p></li></ul><p>Here's the updated grade for Noizu.FastGlobal.Cluster:</p><pre><code class="nlp-grade">grade:
- rubrix: üìö=95,üßæ=90,‚öô=90,üë∑‚Äç‚ôÄÔ∏è=80,üëÆ=90,üé™=90</code></pre>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>

  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#coordinate_put/4" translate="no">coordinate_put(identifier, value, settings, options)</a>

        </div>

          <div class="summary-synopsis"><p>Coordinates the put operation in the FastGlobal cluster.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get/3" translate="no">get(identifier, default \\ nil, options \\ %{})</a>

        </div>

          <div class="summary-synopsis"><p>Retrieves the value for a given identifier from the FastGlobal cluster with a default value and options.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_record/1" translate="no">get_record(identifier)</a>

        </div>

          <div class="summary-synopsis"><p>Retrieves a record for a given identifier from the FastGlobal cluster.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_settings/0" translate="no">get_settings()</a>

        </div>

          <div class="summary-synopsis"><p>Retrieves the settings for the FastGlobal cluster.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#put/3" translate="no">put(identifier, value, options \\ %{})</a>

        </div>

          <div class="summary-synopsis"><p>Puts a value into the FastGlobal cluster.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#sync_record/4" translate="no">sync_record(identifier, default, options, tsup \\ nil)</a>

        </div>

          <div class="summary-synopsis"><p>Retrieves a record from the FastGlobal cluster.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#sync_record__write/4" translate="no">sync_record__write(identifier, value, options, task_supervisor)</a>

        </div>

          <div class="summary-synopsis"><p>Writes a record to the FastGlobal cluster.</p></div>

      </div>

  </div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Functions
    </h1>
    <div class="functions-list">
<section class="detail" id="coordinate_put/4">

  <div class="detail-header">
    <a href="#coordinate_put/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">coordinate_put(identifier, value, settings, options)</h1>

      <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L538" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Coordinates the put operation in the FastGlobal cluster.</p><h2 id="coordinate_put/4-parameters" class="section-heading">
  <a href="#coordinate_put/4-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><code class="inline">identifier</code>: The identifier for the value.</li><li><code class="inline">value</code>: The value to be put into the cluster.</li><li><code class="inline">settings</code>: The cluster settings.</li><li><code class="inline">options</code>: Additional options for the put operation.</li></ul><h2 id="coordinate_put/4-implementation" class="section-heading">
  <a href="#coordinate_put/4-implementation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">implementation</p>
  </a>
  Implementation
</h2>
<p>The logic for the <a href="#coordinate_put/4"><code class="inline">coordinate_put/4</code></a> function in the <a href="Noizu.FastGlobal.Cluster.html#content"><code class="inline">Noizu.FastGlobal.Cluster</code></a> module is as follows:</p><ol><li>It takes the identifier, value, cluster settings, and additional options as inputs.</li><li>It checks if a record for the identifier already exists in the FastGlobal cluster.</li></ol><ul><li>If a record exists, it updates the record with the new value, origin, pool, revision, and timestamp.</li><li>If a record does not exist, it creates a new record with the identifier, origin, pool, value, revision, and timestamp.</li></ul><ol start="3"><li>It acquires a semaphore lock to ensure exclusive access to the identifier for updating.</li><li>It acquires a nested semaphore lock to ensure that write operations are not executed concurrently.</li><li>It waits for a certain period of time to acquire the semaphore lock.</li><li>If the semaphore lock is acquired, it performs the following steps:</li></ol><ul><li>It spawns asynchronous tasks to handle the update operation on each node in the cluster.</li><li>For the local node, it calls the <a href="#put/3"><code class="inline">put/3</code></a> function to update the record.</li><li>For remote nodes, it sends an RPC call or cast to the corresponding node to update the record.</li></ul><ol start="7"><li>It waits for the tasks to complete and returns the result.</li><li>If there is an error during the update process, it logs an error message.</li></ol><p>The logic is designed this way to coordinate the put operation in a distributed cluster environment.
It ensures that only one process can update the record at a time to avoid conflicts and inconsistencies.
By acquiring semaphore locks, it provides synchronization and prevents concurrent write operations.
The use of asynchronous tasks allows for parallel processing of updates on different nodes in the cluster,
improving performance and scalability.</p>
  </section>
</section>
<section class="detail" id="get/3">

    <span id="get/1"></span>

    <span id="get/2"></span>

  <div class="detail-header">
    <a href="#get/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get(identifier, default \\ nil, options \\ %{})</h1>

      <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L367" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Retrieves the value for a given identifier from the FastGlobal cluster with a default value and options.</p><h2 id="get/3-parameters" class="section-heading">
  <a href="#get/3-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><code class="inline">identifier</code>: The identifier for the value.</li><li><code class="inline">default</code>: The default value to be returned if the value is not found.</li><li><code class="inline">options</code>: Additional options for the retrieval.</li></ul><h2 id="get/3-implementation" class="section-heading">
  <a href="#get/3-implementation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">implementation</p>
  </a>
  Implementation
</h2>
<p>The logic for the <a href="#get/1"><code class="inline">get/1</code></a> function in the <a href="Noizu.FastGlobal.Cluster.html#content"><code class="inline">Noizu.FastGlobal.Cluster</code></a> module is as follows:</p><ol><li>It first tries to retrieve the value for the given identifier from the FastGlobal cluster using the <a href="https://hexdocs.pm/fastglobal/1.0.0/FastGlobal.html#get/1"><code class="inline">FastGlobal.get/1</code></a> function.</li><li>If the value is found, it returns the value.</li><li>If the value is not found, it checks if a default value is provided.</li></ol><ul><li>If a default value is provided, it returns the default value.</li><li>If a default value is not provided, it performs the following steps:<ul><li>It acquires a semaphore lock to ensure exclusive access to the identifier.</li><li>It checks if there is a default value provider function. If there is, it calls the function and returns the result.</li><li>If there is no default value provider function, it waits for a certain period of time to acquire the semaphore lock.</li><li>If the semaphore lock is acquired, it releases the semaphore lock and performs the following steps:<ul><li>It retrieves the value for the identifier from the FastGlobal cluster again.</li><li>If the value is found, it returns the value.</li><li>If the value is still not found, it calls the <a href="#sync_record/4"><code class="inline">sync_record/4</code></a> function to synchronize the record in the cluster.</li><li>If there is an error during the synchronization, it returns the error.</li></ul></li><li>If the semaphore lock is not acquired, it returns the default value.</li></ul></li></ul><p>The logic is designed this way to efficiently retrieve values from the FastGlobal cluster while ensuring that only one process can update the record at a time to avoid conflicts. It also provides flexibility by allowing the use of default values and handling different scenarios such as back pressure and timeouts.</p>
  </section>
</section>
<section class="detail" id="get_record/1">

  <div class="detail-header">
    <a href="#get_record/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_record(identifier)</h1>

      <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L461" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Retrieves a record for a given identifier from the FastGlobal cluster.</p><h2 id="get_record/1-parameters" class="section-heading">
  <a href="#get_record/1-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><code class="inline">identifier</code>: The identifier for the record.</li></ul><h2 id="get_record/1-implementation" class="section-heading">
  <a href="#get_record/1-implementation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">implementation</p>
  </a>
  Implementation
</h2>
<p>Pass through to FastGlobal.get</p>
  </section>
</section>
<section class="detail" id="get_settings/0">

  <div class="detail-header">
    <a href="#get_settings/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_settings()</h1>

      <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L82" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Retrieves the settings for the FastGlobal cluster.</p><h1>Returns</h1><p>The settings for the FastGlobal cluster.</p><h1>Implementation</h1><p>The logic for the <a href="#get_settings/0"><code class="inline">get_settings/0</code></a> function in the <a href="Noizu.FastGlobal.Cluster.html#content"><code class="inline">Noizu.FastGlobal.Cluster</code></a> module is as follows:</p><ol><li>It first tries to retrieve the settings by calling the <a href="https://hexdocs.pm/fastglobal/1.0.0/FastGlobal.html#get/2"><code class="inline">FastGlobal.get/2</code></a> function with the <code class="inline">:fast_global_settings</code>
identifier and a default value of an empty map <code class="inline">%{}</code>.</li><li>If the retrieval is successful and the value is not equal to the default value, it returns the settings.</li><li>If the retrieval fails or the value is equal to the default value, it logs a warning message and returns an empty
map <code class="inline">%{}</code> as the default settings.</li></ol><p>The logic is designed this way to ensure that the settings for the FastGlobal cluster are retrieved correctly.
By using the <a href="https://hexdocs.pm/fastglobal/1.0.0/FastGlobal.html#get/2"><code class="inline">FastGlobal.get/2</code></a> function with a default value, it provides a fallback in case the settings are not
present or cannot be retrieved. Logging a warning message helps in identifying potential issues with the settings.
Returning an empty map as the default settings ensures that there is always a valid value to work with, even if
the actual settings are not available.</p><h1>Code Review</h1>
  </section>
</section>
<section class="detail" id="put/3">

    <span id="put/2"></span>

  <div class="detail-header">
    <a href="#put/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put(identifier, value, options \\ %{})</h1>

      <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L489" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Puts a value into the FastGlobal cluster.</p><h2 id="put/3-parameters" class="section-heading">
  <a href="#put/3-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><code class="inline">identifier</code>: The identifier for the value.</li><li><code class="inline">value</code>: The value to be put into the cluster.</li></ul><h2 id="put/3-implementation" class="section-heading">
  <a href="#put/3-implementation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">implementation</p>
  </a>
  Implementation
</h2>
<p>The <a href="#put/3"><code class="inline">put/3</code></a> function in the <a href="Noizu.FastGlobal.Cluster.html#content"><code class="inline">Noizu.FastGlobal.Cluster</code></a> module is used to put a value into the FastGlobal cluster. Here is a concise explanation of how it works:</p><ol><li>Retrieve cluster settings.</li><li>If the put origin is the current node, coordinate the put operation in the cluster using <a href="#coordinate_put/4"><code class="inline">coordinate_put/4</code></a>.</li><li>If the origin is different, send an RPC message to the origin node to perform the put operation.</li><li>In <a href="#coordinate_put/4"><code class="inline">coordinate_put/4</code></a>, update or create a record with the identifier and value.</li><li>Acquire semaphores for exclusive access to write and update operations.</li><li>Coordinate the put operation by putting the record into the cluster and updating local copies on other nodes.</li><li>Release semaphores.</li><li>Return the result of the put operation.</li></ol><p>The reason for this approach is to ensure that the put operation is performed consistently across the cluster and to handle cases where the origin of the put operation is different from the current node. By coordinating the put operation and updating the record in a synchronized manner, the FastGlobal cluster can maintain data consistency and handle distributed updates efficiently.</p>
  </section>
</section>
<section class="detail" id="sync_record/4">

    <span id="sync_record/3"></span>

  <div class="detail-header">
    <a href="#sync_record/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">sync_record(identifier, default, options, tsup \\ nil)</h1>

      <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L257" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Retrieves a record from the FastGlobal cluster.</p><h2 id="sync_record/4-parameters" class="section-heading">
  <a href="#sync_record/4-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><code class="inline">identifier</code>: The identifier for the record.</li><li><code class="inline">default</code>: The default value to be returned if the record is not found.</li><li><code class="inline">options</code>: Additional options for the retrieval.</li><li><code class="inline">tsup</code>: Task Supervisor (optional).</li></ul><h2 id="sync_record/4-description" class="section-heading">
  <a href="#sync_record/4-description" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">description</p>
  </a>
  Description
</h2>
<p>This function retrieves a record from the FastGlobal cluster.</p><h1>Implementation</h1><p>The <a href="#sync_record/4"><code class="inline">sync_record/4</code></a> function in the <a href="Noizu.FastGlobal.Cluster.html#content"><code class="inline">Noizu.FastGlobal.Cluster</code></a> module is responsible for retrieving a record from the FastGlobal cluster.</p><ol><li><p>It first checks if a semaphore lock can be acquired for the given <code class="inline">identifier</code>. If it can, it proceeds to the next step. If not, it returns the default value.</p></li><li><p>It then checks if the record exists in the FastGlobal cluster. If it does, it returns the value of the record.</p></li><li><p>If the record is not found, it checks the type of the <code class="inline">default</code> value provided:</p></li></ol><ul><li>If <code class="inline">default</code> is a function that takes one argument, it calls the function with <code class="inline">false</code> as the argument and returns the result.</li><li>If <code class="inline">default</code> is a function that takes no arguments, it calls the function and returns the result.</li><li>If <code class="inline">default</code> is not a function, it simply returns the <code class="inline">default</code> value.</li></ul><ol start="4"><li><p>If the semaphore lock can be acquired for the <code class="inline">identifier</code>, it waits for a certain period of time specified in the <code class="inline">options</code> before attempting to write the record to the cluster. This is to avoid multiple simultaneous write operations.</p></li><li><p>After the specified wait period, it calls the <a href="#sync_record__write/4"><code class="inline">sync_record__write/4</code></a> function to write the record to the FastGlobal cluster.</p></li><li><p>If the write operation is successful, it releases the semaphore lock and returns the value of the record.</p></li><li><p>If any errors occur during the process, it returns <code class="inline">nil</code>.</p></li></ol><p>In summary, <a href="#sync_record/4"><code class="inline">sync_record/4</code></a> retrieves a record from the FastGlobal cluster and handles cases where the record is not found or needs to be written to the cluster. It ensures that only one write operation is performed at a time to avoid conflicts.</p>
  </section>
</section>
<section class="detail" id="sync_record__write/4">

  <div class="detail-header">
    <a href="#sync_record__write/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">sync_record__write(identifier, value, options, task_supervisor)</h1>

      <a href="https://github.com/noizu/ElixirCore/blob/master/lib/elixir_core/fast_global/cluster.ex#L144" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Writes a record to the FastGlobal cluster.</p><h2 id="sync_record__write/4-parameters" class="section-heading">
  <a href="#sync_record__write/4-parameters" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">parameters</p>
  </a>
  Parameters
</h2>
<ul><li><code class="inline">identifier</code>: The identifier for the record.</li><li><code class="inline">value</code>: The value to be written.</li><li><code class="inline">options</code>: Additional options for the write.</li><li><code class="inline">_tsup</code>: Task Supervisor (optional).</li></ul><h2 id="sync_record__write/4-implementation" class="section-heading">
  <a href="#sync_record__write/4-implementation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">implementation</p>
  </a>
  Implementation
</h2>
<p>The logic for the <a href="#sync_record__write/4"><code class="inline">sync_record__write/4</code></a> function in the <a href="Noizu.FastGlobal.Cluster.html#content"><code class="inline">Noizu.FastGlobal.Cluster</code></a> module is as follows:</p><ol><li>It takes an <code class="inline">identifier</code>, <code class="inline">value</code>, <code class="inline">options</code>, and an optional task supervisor (<code class="inline">_tsup</code>) as input.</li><li>It logs a warning message indicating that a write operation is being performed for the given identifier.</li><li>It retrieves the cluster settings by calling the <a href="#get_settings/0"><code class="inline">get_settings/0</code></a> function.</li><li>It determines the origin node for the write operation based on the options or the cluster settings.</li><li>It performs the following steps based on the origin node:</li></ol><ul><li>If the origin node is the current node, it calls the <a href="#get_record/1"><code class="inline">get_record/1</code></a> function to retrieve the existing record for the identifier.</li><li>If the origin node is different from the current node, it uses RPC to call the <a href="#get_record/1"><code class="inline">get_record/1</code></a> function on the origin node to retrieve the existing record.</li></ul><ol start="6"><li>If there is an error during the retrieval of the existing record, it sets the record to <code class="inline">nil</code>.</li><li>Based on the result of the record retrieval, it performs the following steps:</li></ol><ul><li>If the record is not <code class="inline">nil</code>, it updates the existing record with the new value and other information such as the revision and timestamp.</li><li>If the record is <code class="inline">nil</code>, it creates a new record with the identifier, origin node, pool of nodes, value, revision, and timestamp.</li></ul><ol start="8"><li>It uses a semaphore to ensure exclusive access to the identifier for the write operation.</li><li>It performs the write operation by calling the <a href="#put/3"><code class="inline">put/3</code></a> function to update the record in the FastGlobal cluster.</li><li>It handles the result of the write operation and logs a warning message indicating that the write operation is complete.</li></ol><p>The logic is designed this way to handle the synchronization of writing a record in the FastGlobal cluster across multiple nodes in a distributed cluster. By retrieving the existing record and updating it or creating a new record, it ensures that the most up-to-date information is stored in the cluster. The use of a semaphore helps to manage concurrent write operations and prevent conflicts. The warning messages provide visibility and monitoring of the write operations.</p>
  </section>
</section>

    </div>
  </section>

      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/noizu_core/1.0.26" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/noizu_core/1.0.26" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/noizu_core/1.0.26/show/lib/elixir_core/fast_global/cluster.ex">(current file)</a>

            </span>

            <button class="line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.3) for the
          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
